

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>LDSReader.ReadConfig &mdash; LDSINCR 0.0.2 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="LDSINCR 0.0.2 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">LDSINCR 0.0.2 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for LDSReader.ReadConfig</h1><div class="highlight"><pre>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">v.0.0.1</span>

<span class="sd">LDSIncremental -  LDS Incremental Utilities</span>

<span class="sd">Copyright 2011 Crown copyright (c)</span>
<span class="sd">Land Information New Zealand and the New Zealand Government.</span>
<span class="sd">All rights reserved</span>

<span class="sd">This program is released under the terms of the new BSD license. See the </span>
<span class="sd">LICENSE file for more information.</span>

<span class="sd">Created on 24/07/2012</span>

<span class="sd">@author: jramsay</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">ConfigParser</span>

<span class="kn">from</span> <span class="nn">ConfigParser</span> <span class="kn">import</span> <span class="n">NoOptionError</span><span class="p">,</span><span class="n">NoSectionError</span><span class="p">,</span><span class="n">Error</span>

<span class="n">ldslog</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">(</span><span class="s">&quot;LDS.ReadConfig&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Reader"><a class="viewcode-back" href="../../api/LDSReader.html#LDSReader.ReadConfig.Reader">[docs]</a><span class="k">class</span> <span class="nc">Reader</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    reads a config file of user editable settings for PostgreSQL,FileGDB,ArcSDE,MySQL,MSSQL,DB2,Informix,Oracle</span>
<span class="sd">    &#39;&#39;&#39;</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructor</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">thisdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">thisdir</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_readConfigFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span>
        
        
<div class="viewcode-block" id="Reader.getSections"><a class="viewcode-back" href="../../api/LDSReader.html#LDSReader.ReadConfig.Reader.getSections">[docs]</a>    <span class="k">def</span> <span class="nf">getSections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;list of sections (layernames/datasources)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">sections</span><span class="p">()</span>
        </div>
    <span class="k">def</span> <span class="nf">_readConfigFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fname</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;split off so you can override the config file on the same reader object if needed&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cp</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
                
<span class="c">#    #incremental</span>
<span class="c">#    def readIncrementalConfig(self):</span>
<span class="c">#        try:</span>
<span class="c">#            layer = self.cp.get(&#39;Incremental&#39;, &#39;layer&#39;)</span>
<span class="c">#        except NoSectionError:</span>
<span class="c">#            #no section will be caught for whole read</span>
<span class="c">#            print &quot;Missing Section [Incremental] in config file, setting all to default&quot;</span>
<span class="c">#            return (&quot;All&quot;,None,None,None)</span>
<span class="c">#        except NoOptionError:</span>
<span class="c">#            print &quot;No layer specified, default to All&quot;</span>
<span class="c">#            layer = &quot;All&quot;</span>
<span class="c">#            </span>
<span class="c">#        try:</span>
<span class="c">#            fdate = self.cp.get(&#39;Incremental&#39;, &#39;from&#39;)</span>
<span class="c">#            tdate = self.cp.get(&#39;Incremental&#39;, &#39;to&#39;)</span>
<span class="c">#        except NoOptionError:</span>
<span class="c">#            print &quot;One or more missing dates, default to Full Replicate&quot;</span>
<span class="c">#            fdate = None</span>
<span class="c">#            tdate = None</span>
<span class="c">#        </span>
<span class="c">#        try:</span>
<span class="c">#            cql = self.cp.get(&#39;Incremental&#39;, &#39;cql&#39;)</span>
<span class="c">#        except NoOptionError:</span>
<span class="c">#            #silently discard, not implemented</span>
<span class="c">#            cql = None</span>
<span class="c">#        </span>
<span class="c">#        return (layer,fdate,tdate,cql)</span>
    
    <span class="c">#database</span>
        
<div class="viewcode-block" id="Reader.readPostgreSQLConfig"><a class="viewcode-back" href="../../api/LDSReader.html#LDSReader.ReadConfig.Reader.readPostgreSQLConfig">[docs]</a>    <span class="k">def</span> <span class="nf">readPostgreSQLConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;PostgreSQL&#39;</span><span class="p">,</span> <span class="s">&#39;host&#39;</span><span class="p">)</span>
        <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;PostgreSQL&#39;</span><span class="p">,</span> <span class="s">&#39;port&#39;</span><span class="p">)</span>
        <span class="n">dbname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;PostgreSQL&#39;</span><span class="p">,</span> <span class="s">&#39;dbname&#39;</span><span class="p">)</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;PostgreSQL&#39;</span><span class="p">,</span> <span class="s">&#39;schema&#39;</span><span class="p">)</span>
        <span class="n">usr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;PostgreSQL&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">)</span>
        <span class="n">pwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;PostgreSQL&#39;</span><span class="p">,</span> <span class="s">&#39;pass&#39;</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">over</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;PostgreSQL&#39;</span><span class="p">,</span> <span class="s">&#39;overwrite&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoOptionError</span><span class="p">:</span>
            <span class="n">ldslog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;PG: Overwrite not specified, Setting to True&quot;</span><span class="p">)</span>
            <span class="n">over</span> <span class="o">=</span> <span class="bp">True</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">dbname</span><span class="p">,</span><span class="n">schema</span><span class="p">,</span><span class="n">usr</span><span class="p">,</span><span class="n">pwd</span><span class="p">,</span><span class="n">over</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="Reader.readMSSQLConfig"><a class="viewcode-back" href="../../api/LDSReader.html#LDSReader.ReadConfig.Reader.readMSSQLConfig">[docs]</a>    <span class="k">def</span> <span class="nf">readMSSQLConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">odbc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;MSSQL&#39;</span><span class="p">,</span> <span class="s">&#39;odbc&#39;</span><span class="p">)</span>
        <span class="n">server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;MSSQL&#39;</span><span class="p">,</span> <span class="s">&#39;server&#39;</span><span class="p">)</span>
        <span class="n">dsn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;MSSQL&#39;</span><span class="p">,</span> <span class="s">&#39;dsn&#39;</span><span class="p">)</span>
        <span class="n">trust</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;MSSQL&#39;</span><span class="p">,</span> <span class="s">&#39;trust&#39;</span><span class="p">)</span>
        <span class="n">dbname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;MSSQL&#39;</span><span class="p">,</span> <span class="s">&#39;dbname&#39;</span><span class="p">)</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;MSSQL&#39;</span><span class="p">,</span> <span class="s">&#39;schema&#39;</span><span class="p">)</span>
        
        <span class="n">usr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;MSSQL&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">)</span>
        <span class="n">pwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;MSSQL&#39;</span><span class="p">,</span> <span class="s">&#39;pass&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="n">odbc</span><span class="p">,</span><span class="n">server</span><span class="p">,</span><span class="n">dsn</span><span class="p">,</span><span class="n">trust</span><span class="p">,</span><span class="n">dbname</span><span class="p">,</span><span class="n">schema</span><span class="p">,</span><span class="n">usr</span><span class="p">,</span><span class="n">pwd</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="Reader.readSpatiaLiteConfig"><a class="viewcode-back" href="../../api/LDSReader.html#LDSReader.ReadConfig.Reader.readSpatiaLiteConfig">[docs]</a>    <span class="k">def</span> <span class="nf">readSpatiaLiteConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;SpatiaLite&#39;</span><span class="p">,</span> <span class="s">&#39;path&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">path</span>
    
    
<span class="c">#    def readOracleConfig(self):</span>
<span class="c">#</span>
<span class="c">#        instance = self.cp.get(&#39;Oracle&#39;, &#39;instance&#39;)</span>
<span class="c">#        usr = self.cp.get(&#39;Oracle&#39;, &#39;user&#39;)</span>
<span class="c">#        pwd = self.cp.get(&#39;Oracle&#39;, &#39;pass&#39;)</span>
<span class="c">#        </span>
<span class="c">#        return (instance,usr,pwd)</span>
<span class="c">#        </span>
<span class="c">#        </span>
<span class="c">#    def readMySQLConfig(self):</span>
<span class="c">#</span>
<span class="c">#        host = self.cp.get(&#39;MySQL&#39;, &#39;host&#39;)</span>
<span class="c">#        port = self.cp.get(&#39;MySQL&#39;, &#39;port&#39;)</span>
<span class="c">#        dbname = self.cp.get(&#39;MySQL&#39;, &#39;dbname&#39;)</span>
<span class="c">#        usr = self.cp.get(&#39;MySQL&#39;, &#39;user&#39;)</span>
<span class="c">#        pwd = self.cp.get(&#39;MySQL&#39;, &#39;pass&#39;)</span>
<span class="c">#        </span>
<span class="c">#        return (host,port,dbname,usr,pwd)</span>
<span class="c">#    </span>
<span class="c">#    def readArcSDEConfig(self):</span>
<span class="c">#</span>
<span class="c">#        server = self.cp.get(&#39;ArcSDE&#39;, &#39;server&#39;)</span>
<span class="c">#        instance = self.cp.get(&#39;ArcSDE&#39;, &#39;instance&#39;)</span>
<span class="c">#        database = self.cp.get(&#39;ArcSDE&#39;, &#39;database&#39;)</span>
<span class="c">#        username = self.cp.get(&#39;ArcSDE&#39;, &#39;user&#39;)</span>
<span class="c">#        password = self.cp.get(&#39;ArcSDE&#39;, &#39;pass&#39;)</span>
<span class="c">#        </span>
<span class="c">#        return (server, instance, database, username, password) </span>
    
    <span class="c">#file    </span>
    </div>
<div class="viewcode-block" id="Reader.readFileConfig"><a class="viewcode-back" href="../../api/LDSReader.html#LDSReader.ReadConfig.Reader.readFileConfig">[docs]</a>    <span class="k">def</span> <span class="nf">readFileConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;File&#39;</span><span class="p">,</span> <span class="s">&#39;prefix&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoOptionError</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="k">try</span><span class="p">:</span> 
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;File&#39;</span><span class="p">,</span> <span class="s">&#39;path&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoOptionError</span><span class="p">:</span>
            <span class="n">ldslog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;File: No path specified, default to Home directory&quot;</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="s">&quot;~&quot;</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span><span class="n">path</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="Reader.readFileGDBConfig"><a class="viewcode-back" href="../../api/LDSReader.html#LDSReader.ReadConfig.Reader.readFileGDBConfig">[docs]</a>    <span class="k">def</span> <span class="nf">readFileGDBConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">try</span><span class="p">:</span> 
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;FileGDB&#39;</span><span class="p">,</span> <span class="s">&#39;path&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoOptionError</span><span class="p">:</span>
            <span class="n">ldslog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;FileGDB: No path specified, default to Home directory&quot;</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="s">&quot;~&quot;</span>
        
        <span class="k">return</span> <span class="n">path</span>
    
    
    <span class="c">#web</span>
    </div>
<div class="viewcode-block" id="Reader.readWFSConfig"><a class="viewcode-back" href="../../api/LDSReader.html#LDSReader.ReadConfig.Reader.readWFSConfig">[docs]</a>    <span class="k">def</span> <span class="nf">readWFSConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;WFS&#39;</span><span class="p">,</span> <span class="s">&#39;url&#39;</span><span class="p">)</span> 
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;WFS&#39;</span><span class="p">,</span> <span class="s">&#39;key&#39;</span><span class="p">)</span> 
        <span class="n">svc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;WFS&#39;</span><span class="p">,</span> <span class="s">&#39;svc&#39;</span><span class="p">)</span> 
        <span class="n">ver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;WFS&#39;</span><span class="p">,</span> <span class="s">&#39;ver&#39;</span><span class="p">)</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;WFS&#39;</span><span class="p">,</span> <span class="s">&#39;fmt&#39;</span><span class="p">)</span>
        <span class="n">cql</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;WFS&#39;</span><span class="p">,</span> <span class="s">&#39;cql&#39;</span><span class="p">)</span>
        
        
        <span class="k">return</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">svc</span><span class="p">,</span><span class="n">ver</span><span class="p">,</span><span class="n">fmt</span><span class="p">,</span><span class="n">cql</span><span class="p">)</span>    
    </div>
<div class="viewcode-block" id="Reader.readLDSConfig"><a class="viewcode-back" href="../../api/LDSReader.html#LDSReader.ReadConfig.Reader.readLDSConfig">[docs]</a>    <span class="k">def</span> <span class="nf">readLDSConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;LDS&#39;</span><span class="p">,</span> <span class="s">&#39;url&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoOptionError</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://wfs.data.linz.govt/&quot;</span>
        <span class="k">except</span> <span class="n">NoSectionError</span><span class="p">:</span>
            <span class="n">ldslog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;LDS: No LDS Section... Cannot recover, quitting&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
        <span class="k">try</span><span class="p">:</span> 
            <span class="n">fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;LDS&#39;</span><span class="p">,</span> <span class="s">&#39;fmt&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoOptionError</span><span class="p">:</span>
            <span class="n">ldslog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;LDS: No output format specified, default to GML2&quot;</span><span class="p">)</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s">&quot;GML2&quot;</span>
        
        <span class="k">try</span><span class="p">:</span> 
            <span class="n">svc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;LDS&#39;</span><span class="p">,</span> <span class="s">&#39;svc&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoOptionError</span><span class="p">:</span>
            <span class="n">ldslog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;LDS: No service type specified, default to WFS&quot;</span><span class="p">)</span>
            <span class="n">svc</span> <span class="o">=</span> <span class="s">&quot;WFS&quot;</span>
        
        <span class="k">try</span><span class="p">:</span> 
            <span class="n">ver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;LDS&#39;</span><span class="p">,</span> <span class="s">&#39;ver&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoOptionError</span><span class="p">:</span>
            <span class="n">ldslog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;LDS: No Version specified, assuming WFS and default to version 1.0.0&quot;</span><span class="p">)</span>
            <span class="n">ver</span> <span class="o">=</span> <span class="s">&quot;1.0.0&quot;</span>
        
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;LDS&#39;</span><span class="p">,</span> <span class="s">&#39;key&#39;</span><span class="p">)</span> 
        
        <span class="k">return</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">svc</span><span class="p">,</span><span class="n">ver</span><span class="p">,</span><span class="n">fmt</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="Reader.readProxyConfig"><a class="viewcode-back" href="../../api/LDSReader.html#LDSReader.ReadConfig.Reader.readProxyConfig">[docs]</a>    <span class="k">def</span> <span class="nf">readProxyConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Proxy&#39;</span><span class="p">,</span> <span class="s">&#39;host&#39;</span><span class="p">)</span> 
        <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Proxy&#39;</span><span class="p">,</span> <span class="s">&#39;port&#39;</span><span class="p">)</span> 
        <span class="n">usr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Proxy&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">)</span> 
        <span class="n">pwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Proxy&#39;</span><span class="p">,</span> <span class="s">&#39;pass&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">usr</span><span class="p">,</span><span class="n">pwd</span><span class="p">)</span>
    
    
    
    <span class="c">#----------------------------------------------------------------------------------------------</span>
    </div>
<div class="viewcode-block" id="Reader.findLayerIdByName"><a class="viewcode-back" href="../../api/LDSReader.html#LDSReader.ReadConfig.Reader.findLayerIdByName">[docs]</a>    <span class="k">def</span> <span class="nf">findLayerIdByName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;reverse lookup of section by associated name, finds first occurance only&#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">section_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">sections</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section_name</span><span class="p">,</span><span class="s">&#39;name&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">section_name</span>
        <span class="k">return</span> <span class="n">name</span>
    </div>
<div class="viewcode-block" id="Reader.readLayerSchemaConfig"><a class="viewcode-back" href="../../api/LDSReader.html#LDSReader.ReadConfig.Reader.readLayerSchemaConfig">[docs]</a>    <span class="k">def</span> <span class="nf">readLayerSchemaConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">layer</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;assuming that when the reader for this method call is instantiated it will point at some non-def </span>
<span class="sd">        config file might be expecting too much, so uncomment below if needed&#39;&#39;&#39;</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">defn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="s">&#39;sql&#39;</span><span class="p">)</span>
            <span class="c">#if the user has gone to the trouble of defining their own schema in SQL who are we to argue. assume pk and geo defined within</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">defn</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="sd">&#39;&#39;&#39;optional but one way to record the type and name of a column is to save a string tuple (name,type) and parse this at build time&#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pkey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="s">&#39;pkey&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoOptionError</span><span class="p">:</span>
            <span class="n">ldslog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;LayerSchema: No Primary Key Column defined, default to &#39;ID&#39;&quot;</span><span class="p">)</span>
            <span class="n">pkey</span> <span class="o">=</span> <span class="s">&#39;(ID, Integer)&#39;</span>
            
        <span class="sd">&#39;&#39;&#39;names are/can-be stored so we can reverse search by layer name&#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoOptionError</span><span class="p">:</span>
            <span class="n">ldslog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;LayerSchema: No Name saved in config for this layer, returning ID&quot;</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">layer</span>
            
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">layer</span>
            
        <span class="k">try</span><span class="p">:</span>
            <span class="n">gcol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="s">&#39;geocolumn&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoOptionError</span><span class="p">:</span>
            <span class="n">ldslog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;LayerSchema: No Geo Column defined, default to &#39;SHAPE&#39;&quot;</span><span class="p">)</span>
            <span class="n">gcol</span> <span class="o">=</span> <span class="s">&#39;SHAPE&#39;</span>
            
        <span class="k">try</span><span class="p">:</span>
            <span class="n">epsg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="s">&#39;epsg&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoOptionError</span><span class="p">:</span>
            <span class="c">#print &quot;No Projection Transformation defined&quot;#don&#39;t really need to state the default occurance</span>
            <span class="n">epsg</span> <span class="o">=</span> <span class="bp">None</span>
            
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lmod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="s">&#39;lastmodified&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoOptionError</span><span class="p">:</span>
            <span class="n">ldslog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;LayerSchema: No Last-Modified date recorded, successful update will write current time here&quot;</span><span class="p">)</span>
            <span class="n">lmod</span> <span class="o">=</span> <span class="bp">None</span>
            
        <span class="k">try</span><span class="p">:</span>
            <span class="n">disc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="s">&#39;discard&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoOptionError</span><span class="p">:</span>
            <span class="n">disc</span> <span class="o">=</span> <span class="bp">None</span> 
            
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cql</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="s">&#39;cql&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoOptionError</span><span class="p">:</span>
            <span class="n">cql</span> <span class="o">=</span> <span class="bp">None</span>
            
        <span class="k">return</span> <span class="p">(</span><span class="n">pkey</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">gcol</span><span class="p">,</span><span class="n">epsg</span><span class="p">,</span><span class="n">lmod</span><span class="p">,</span><span class="n">disc</span><span class="p">,</span><span class="n">cql</span><span class="p">)</span>
    
    
    </div>
<div class="viewcode-block" id="Reader.writeLayerSchemaConfig"><a class="viewcode-back" href="../../api/LDSReader.html#LDSReader.ReadConfig.Reader.writeLayerSchemaConfig">[docs]</a>    <span class="k">def</span> <span class="nf">writeLayerSchemaConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">layer</span><span class="p">,</span><span class="n">lmod</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;write changes to config file remembering the config file was chosen in the object call. &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span><span class="s">&#39;lastmodified&#39;</span><span class="p">,</span><span class="n">lmod</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Error</span><span class="p">:</span>
            <span class="n">ldslog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;LayerSchema(W): Last-Modified date not saved!&quot;</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span><span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conffile</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">conffile</span><span class="p">)</span>
        
        
             
        
        
        
        
        
        
    </div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">LDSINCR 0.0.2 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, jramsay.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>